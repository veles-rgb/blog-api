generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Users {
  id             String @id @default(uuid()) @db.Uuid
  username       String @unique @db.VarChar(21) // min length 3 & trimmed — enforced in application
  email          String @unique @db.VarChar(254) // min length 6 — enforced in application
  hashedPassword String

  isAuthor Boolean @default(false)
  isAdmin  Boolean @default(false)

  createdAt DateTime @default(now())

  posts     Posts[]
  comments  Comments[]
  postLikes Post_Likes[]
}

model Posts {
  id String @id @default(uuid()) @db.Uuid

  authorId String @db.Uuid
  author   Users  @relation(fields: [authorId], references: [id], onDelete: Cascade)

  title   String @db.VarChar(150) // min length 2 — enforced in application
  content String //
  slug    String // URL-friendly identifier — enforced in application

  isPublished Boolean   @default(false)
  publishedAt DateTime?

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())

  comments  Comments[]
  postLikes Post_Likes[]

  @@unique([authorId, slug])
  @@index([authorId])
}

model Comments {
  id String @id @default(uuid()) @db.Uuid

  postId String @db.Uuid
  post   Posts  @relation(fields: [postId], references: [id], onDelete: Cascade)

  userId String @db.Uuid
  user   Users  @relation(fields: [userId], references: [id], onDelete: Cascade)

  content String // min 1 max 1000 — enforced in application

  createdAt DateTime @default(now())

  @@index([postId])
  @@index([userId])
}

model Post_Likes {
  id String @id @default(uuid()) @db.Uuid

  userId String @db.Uuid
  user   Users  @relation(fields: [userId], references: [id], onDelete: Cascade)

  postId String @db.Uuid
  post   Posts  @relation(fields: [postId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([userId, postId]) // User can only like once per post
  @@index([postId])
  @@index([userId])
}